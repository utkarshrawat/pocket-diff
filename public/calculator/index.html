<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TVM Financial Calculator (BA II Plus)</title>
    <meta name="description" content="Free online Time Value of Money (TVM) calculator. Compute NPV, IRR, and Amortization. Matches BA II Plus logic.">
    <link rel="canonical" href="https://pocketbattlesimulator.com/calculator/" />

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav></nav>
    <div class="container">
        <div class="center-view">
            <div class="mode-toggle center-margin">
                <button class="mode-btn active" id="btn-calc" onclick="toggleFin('calc', this)">Calculator</button>
                <button class="mode-btn" id="btn-adv" onclick="toggleFin('adv', this)">Analysis</button>
            </div>

            <div id="view-calc">
                <div class="settings-bar">
                    <div class="setting-group"><label>P/Y</label><input type="number" id="input_py" value="12" oninput="syncCY()"></div>
                    <div class="setting-group"><label>C/Y</label><input type="number" id="input_cy" value="12"></div>
                    <div class="setting-group"><label>Mode</label><button id="btn_bgn" class="toggle-btn" onclick="toggleBGN()">END</button></div>
                </div>

                <div class="tvm-dashboard">
                    <div class="tvm-group">
                        <label>N <span class="info-icon" data-tooltip="Number of Periods.&#10;e.g. 30 years * 12 = 360">i</span></label>
                        <input type="number" id="input_n"><button class="btn-mini" onclick="solveFor('n')">CPT</button>
                    </div>
                    <div class="tvm-group">
                        <label>I/Y <span class="info-icon" data-tooltip="Annual Interest Rate %.&#10;Enter 5.5 for 5.5%">i</span></label>
                        <input type="number" id="input_i"><button class="btn-mini" onclick="solveFor('i')">CPT</button>
                    </div>
                    <div class="tvm-group">
                        <label>PV <span class="info-icon" data-tooltip="Present Value.&#10;Loan (+) or Invest (-)">i</span></label>
                        <input type="number" id="input_pv"><button class="btn-mini" onclick="solveFor('pv')">CPT</button>
                    </div>
                    <div class="tvm-group">
                        <label>PMT <span class="info-icon" data-tooltip="Payment.&#10;Pay (-) or Receive (+)">i</span></label>
                        <input type="number" id="input_pmt"><button class="btn-mini" onclick="solveFor('pmt')">CPT</button>
                    </div>
                    <div class="tvm-group">
                        <label>FV <span class="info-icon" data-tooltip="Future Value.&#10;Usually 0 for loans.">i</span></label>
                        <input type="number" id="input_fv"><button class="btn-mini" onclick="solveFor('fv')">CPT</button>
                    </div>
                </div>

                <div class="calc-body">
                    <div class="toast-container">
                        <div id="calcToast" class="toast-message"></div>
                    </div>
                    
                    <input type="text" class="calc-screen" id="calcDisplay" value="0" readonly>
                    
                    <div class="calc-grid">
                        <button class="btn-func" onclick="assignToInput('n')">N</button>
                        <button class="btn-func" onclick="assignToInput('i')">I/Y</button>
                        <button class="btn-func" onclick="assignToInput('pv')">PV</button>
                        <button class="btn-func" onclick="assignToInput('pmt')">PMT</button>
                        <button class="btn-func" onclick="assignToInput('fv')">FV</button>
                        <button class="btn-danger" onclick="resetTVM()">CLR</button>
                        <button class="btn-num" onclick="calcInput('(')">(</button>
                        <button class="btn-num" onclick="calcInput(')')">)</button>
                        <button class="btn-num" onclick="calcInput('1/x')">1/x</button>
                        <button class="btn-op" onclick="calcInput('/')">÷</button>
                        <button class="btn-num" onclick="calcInput('7')">7</button>
                        <button class="btn-num" onclick="calcInput('8')">8</button>
                        <button class="btn-num" onclick="calcInput('9')">9</button>
                        <button class="btn-op" onclick="calcInput('*')">×</button>
                        <button class="btn-num" onclick="calcInput('sqrt')">√x</button>
                        <button class="btn-num" onclick="calcInput('4')">4</button>
                        <button class="btn-num" onclick="calcInput('5')">5</button>
                        <button class="btn-num" onclick="calcInput('6')">6</button>
                        <button class="btn-op" onclick="calcInput('-')">-</button>
                        <button class="btn-num" onclick="calcInput('y^x')">yˣ</button>
                        <button class="btn-num" onclick="calcInput('1')">1</button>
                        <button class="btn-num" onclick="calcInput('2')">2</button>
                        <button class="btn-num" onclick="calcInput('3')">3</button>
                        <button class="btn-op" onclick="calcInput('+')">+</button>
                        <button class="btn-num" onclick="calcInput('+/-')">±</button>
                        <button class="btn-num" onclick="calcInput('0')">0</button>
                        <button class="btn-num" onclick="calcInput('.')">.</button>
                        <button class="btn-submit" style="grid-column: span 2;" onclick="calculateResult()">ENTER</button>
                        <button class="btn-danger" onclick="backspace()">⌫</button>
                    </div>
                </div>
            </div>

            <div id="view-adv" style="display:none;">
                <div class="panel-grid">
                    <div class="panel">
                        <h3>Amortization Schedule</h3>
                        <p class="subtext">Generate Schedule. (Inputs synced from Calculator)</p>
                        <div class="row-group">
                            <div class="setting-group"><label>N <span class="info-icon" data-tooltip="Total Payments">i</span></label><input type="number" id="amort_n"></div>
                            <div class="setting-group"><label>I/Y <span class="info-icon" data-tooltip="Interest %">i</span></label><input type="number" id="amort_i"></div>
                        </div>
                        <div class="row-group">
                            <div class="setting-group"><label>PV <span class="info-icon" data-tooltip="Principal">i</span></label><input type="number" id="amort_pv"></div>
                            <div class="setting-group"><label>PMT <span class="info-icon" data-tooltip="Payment">i</span></label><input type="number" id="amort_pmt"></div>
                        </div>
                        <button class="action-btn" style="width:100%; margin-top:10px;" onclick="generateAmortization()">Generate</button>
                        <div id="amortTableContainer"></div>
                    </div>

                    <div class="panel">
                        <h3>Interest Conversion</h3>
                        <p class="subtext">Nominal (NOM) ↔ Effective (EFF)</p>
                        <div class="form-group"><label>Nominal % (NOM) <span class="info-icon" data-tooltip="Annual Percentage Rate (APR)">i</span></label><input type="number" id="iconv_nom"></div>
                        <div class="form-group" style="margin-top:10px;"><label>Effective % (EFF) <span class="info-icon" data-tooltip="Annual Percentage Yield (APY)">i</span></label><input type="number" id="iconv_eff"></div>
                        <div class="form-group" style="margin-top:10px;"><label>C/Y</label><input type="number" id="iconv_cy" value="12"></div>
                        <div class="row-group" style="margin-top:20px;">
                            <button class="action-btn outline small" onclick="calcIconv('eff')">Compute EFF</button>
                            <button class="action-btn outline small" onclick="calcIconv('nom')">Compute NOM</button>
                        </div>
                    </div>
                    
                    <div class="panel" style="grid-column: span 2;">
                        <h3>Cash Flow (NPV/IRR)</h3>
                        <div class="row-group">
                            <div class="form-group"><label>Initial (CF0) <span class="info-icon" data-tooltip="Cost (Negative)">i</span></label><input type="number" id="cf0" placeholder="-10000"></div>
                            <div class="form-group"><label>Rate %</label><input type="number" id="discountRate" placeholder="10"></div>
                        </div>
                        <div class="form-group"><label>Flows (comma sep) <span class="info-icon" data-tooltip="Example: 2000, 3000, 4000">i</span></label><input type="text" id="cashFlows" placeholder="2000, 3000..."></div>
                        <button class="action-btn" style="width:100%; margin-top:10px;" onclick="calculateNPV_IRR()">Calculate</button>
                        <div id="npvResult" class="result-box" style="display:none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../js/nav.js"></script>
    <script src="../js/storage.js"></script>
    <script src="script.js"></script>
</body>
</html>